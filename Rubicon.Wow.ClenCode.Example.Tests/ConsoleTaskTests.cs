using Moq;
using Rubicon.Wow.CleanCode.Example;
using System;
using System.Net.Http;
using System.Threading.Tasks;
using Xunit;

namespace Rubicon.Wow.ClenCode.Example.Tests;
public class ConsoleTaskTests
{
    const string data = @"{""Data"":[{""Films"":[],""ShortFilms"":[],""TvShows"":[],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""\u0027Olu Mel"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/6/61/Olu_main.png"",""Url"":""https://api.disneyapi.dev/characters/6"",""_id"":6},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Gravity Falls""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":"".GIFfany"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/5/51/Giffany.png"",""Url"":""https://api.disneyapi.dev/characters/7"",""_id"":7},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Lilo \u0026 Stitch: The Series"",""Stitch!""],""videoGames"":[""Disney Tsum Tsum (game)""],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""627"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/8/80/Profile_-_627.png"",""Url"":""https://api.disneyapi.dev/characters/10"",""_id"":10},{""Films"":[],""ShortFilms"":[],""TvShows"":[],""videoGames"":[],""ParkAttractions"":[""The Timekeeper""],""Allies"":[],""Enemies"":[],""Name"":""9-Eye"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/7/77/9-eye.jpg"",""Url"":""https://api.disneyapi.dev/characters/11"",""_id"":11},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Pickle and Peanut""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""90\u0027s Adventure Bear"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/3/3f/90%27s_Adventure_Bear_profile.png"",""Url"":""https://api.disneyapi.dev/characters/12"",""_id"":12},{""Films"":[],""ShortFilms"":[],""TvShows"":[],""videoGames"":[""Epic Mickey 2: The Power of Two""],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""A.B.E."",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/2/20/ABE.jpg"",""Url"":""https://api.disneyapi.dev/characters/13"",""_id"":13},{""Films"":[""The Computer Wore Tennis Shoes"",""Now You See Him, Now You Don\u0027t"",""The Strongest Man in the World""],""ShortFilms"":[],""TvShows"":[],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""A.J. Arno"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/2/2c/A.J._Arno.jpg"",""Url"":""https://api.disneyapi.dev/characters/14"",""_id"":14},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Puppy Dog Pals""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""A.R.F."",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/b/ba/A.R.F.png"",""Url"":""https://api.disneyapi.dev/characters/15"",""_id"":15},{""Films"":[""Cheetah""],""ShortFilms"":[],""TvShows"":[],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Abdullah"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/c/cb/1087603-44532-clp-950.jpg"",""Url"":""https://api.disneyapi.dev/characters/16"",""_id"":16},{""Films"":[],""ShortFilms"":[],""TvShows"":[""The Legend of Tarzan""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Abigail Markham"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/9/95/Abigail_Markham.jpeg"",""Url"":""https://api.disneyapi.dev/characters/17"",""_id"":17},{""Films"":[""The Fox and the Hound"",""The Fox and the Hound 2""],""ShortFilms"":[],""TvShows"":[],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Abigail the Cow"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/0/05/Fox-disneyscreencaps_com-901.jpg"",""Url"":""https://api.disneyapi.dev/characters/18"",""_id"":18},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Once Upon a Time""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Abigail"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/d/dd/Regalblond.jpg"",""Url"":""https://api.disneyapi.dev/characters/19"",""_id"":19},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Elena of Avalor""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Queen Abigail"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/f/fa/Normal_EoA_S3_E4_0217.jpg"",""Url"":""https://api.disneyapi.dev/characters/20"",""_id"":20},{""Films"":[""The Return of Jafar"",""Aladdin and the King of Thieves""],""ShortFilms"":[],""TvShows"":[""Aladdin (TV series)""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Abis Mal\u0027s Thugs"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/b/ba/Abis_Mal%27s_Thugs.jpg"",""Url"":""https://api.disneyapi.dev/characters/21"",""_id"":21},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Tron: Uprising""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Able"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/a/af/Able.png"",""Url"":""https://api.disneyapi.dev/characters/22"",""_id"":22},{""Films"":[],""ShortFilms"":[],""TvShows"":[],""videoGames"":[""Tron: Evolution""],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Abraxas"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/c/ce/Abraxas.jpg"",""Url"":""https://api.disneyapi.dev/characters/23"",""_id"":23},{""Films"":[""Alice in Wonderland (2010 film)"",""Alice Through the Looking Glass""],""ShortFilms"":[],""TvShows"":[],""videoGames"":[""Alice in Wonderland (2010 video game)"",""Disney Universe"",""Disney Crossy Road""],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Absolem"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/4/4d/Caterpillar.jpg"",""Url"":""https://api.disneyapi.dev/characters/24"",""_id"":24},{""Films"":[""Aladdin (film)"",""The Return of Jafar"",""Aladdin and the King of Thieves"",""Mickey\u0027s Magical Christmas: Snowed in at the House of Mouse"",""Disney Princess Enchanted Tales: Follow Your Dreams"",""Aladdin (2019 film)""],""ShortFilms"":[],""TvShows"":[""Aladdin (TV series)"",""Hercules (TV series)"",""House of Mouse""],""videoGames"":[""Aladdin (video game)"",""Disney\u0027s ReadingQuest With Aladdin"",""Disney\u0027s MathQuest With Aladdin"",""Disney\u0027s Aladdin in Nasira\u0027s Revenge"",""Kingdom Hearts (series)"",""Disney Universe"",""Disney Princess Enchanting Storybooks"",""Epic Mickey: Power of Illusion"",""disney:Hidden Worlds"",""Disney Infinity (series)"",""Disney Villains Challenge"",""Disney Tsum Tsum (game)"",""Disney Crossy Road"",""Disney Magic Kingdoms"",""Disney Emoji Blitz"",""Disney Getaway Blast"",""Disney Princess Majestic Quest""],""ParkAttractions"":[""Garden of the Twelve Friends"",""Voyage to the Crystal Grotto""],""Allies"":[],""Enemies"":[],""Name"":""Abu"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/3/3f/Profile_-_Abu.png"",""Url"":""https://api.disneyapi.dev/characters/25"",""_id"":25},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Gravity Falls""],""videoGames"":[""Gravity Falls: Legend of the Gnome Gemulets""],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Abuelita"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/c/cd/Profile_-_Abuelita.png"",""Url"":""https://api.disneyapi.dev/characters/26"",""_id"":26},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Handy Manny""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Abuelito"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/c/c8/Char_51942_thumb.jpg"",""Url"":""https://api.disneyapi.dev/characters/27"",""_id"":27},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Big Hero 6: The Series""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""AC and DC"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/7/75/Profile_-_AC_and_DC.jpg"",""Url"":""https://api.disneyapi.dev/characters/28"",""_id"":28},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Kim Possible""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Professor Acari"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/5/5d/Professor_Acari.jpg"",""Url"":""https://api.disneyapi.dev/characters/29"",""_id"":29},{""Films"":[""Leroy \u0026 Stitch""],""ShortFilms"":[],""TvShows"":[""Lilo \u0026 Stitch: The Series"",""Stitch!""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Ace"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/1/1e/Profile_-_Ace.png"",""Url"":""https://api.disneyapi.dev/characters/30"",""_id"":30},{""Films"":[""The Hunchback of Notre Dame"",""The Hunchback of Notre Dame II""],""ShortFilms"":[],""TvShows"":[],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Achilles"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/8/8f/Achilles_HOND.jpg"",""Url"":""https://api.disneyapi.dev/characters/31"",""_id"":31},{""Films"":[""Aladdin (film)"",""Aladdin (2019 film)""],""ShortFilms"":[],""TvShows"":[""Once Upon a Time""],""videoGames"":[""Disney Crossy Road""],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Prince Achmed"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/7/76/Aladdin-disneyscreencaps.com-1123.jpg"",""Url"":""https://api.disneyapi.dev/characters/33"",""_id"":33},{""Films"":[""Saludos Amigos""],""ShortFilms"":[],""TvShows"":[],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Aconcagua"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/3/32/Saludos-Amigos-classic-disney-18407142-800-600.jpg"",""Url"":""https://api.disneyapi.dev/characters/34"",""_id"":34},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Tron: Uprising""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Ada"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/f/f9/Ada.png"",""Url"":""https://api.disneyapi.dev/characters/35"",""_id"":35},{""Films"":[],""ShortFilms"":[],""TvShows"":[""K.C. Undercover""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Candace Adams"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/8/8b/Enemy_of_the_State_promo_3.jpg"",""Url"":""https://api.disneyapi.dev/characters/36"",""_id"":36},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Dog With a Blog""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Gator Adams"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/6/60/LeonaGatorAdams.jpg"",""Url"":""https://api.disneyapi.dev/characters/37"",""_id"":37},{""Films"":[],""ShortFilms"":[],""TvShows"":[""The Suite Life on Deck""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Addison"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/0/05/Addison_from_slod.jpg"",""Url"":""https://api.disneyapi.dev/characters/38"",""_id"":38},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Hannah Montana""],""videoGames"":[""Hannah Montana (video game)""],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Amber Addison"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/5/52/250px-Amber.jpg"",""Url"":""https://api.disneyapi.dev/characters/40"",""_id"":40},{""Films"":[""Genius""],""ShortFilms"":[],""TvShows"":[],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Claire Addison"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/7/79/Claireaddison.jpeg"",""Url"":""https://api.disneyapi.dev/characters/41"",""_id"":41},{""Films"":[""Mickey\u0027s Good Deed""],""ShortFilms"":[],""TvShows"":[],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Adelbert"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/2/21/Adelbert.jpg"",""Url"":""https://api.disneyapi.dev/characters/42"",""_id"":42},{""Films"":[],""ShortFilms"":[""Mickey\u0027s Good Deed""],""TvShows"":[],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Adelbert\u0027s Father"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/9/96/Adelbertsfather.jpg"",""Url"":""https://api.disneyapi.dev/characters/43"",""_id"":43},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Tangled: The Series""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Adira"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/f/fa/Adira_Tangled.jpeg"",""Url"":""https://api.disneyapi.dev/characters/44"",""_id"":44},{""Films"":[""Mary Poppins (film)"",""Mary Poppins Returns""],""ShortFilms"":[],""TvShows"":[],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Admiral Boom and Mr. Binnacle"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/b/be/Marypoppins-disneyscreencaps_com-1086.jpg"",""Url"":""https://api.disneyapi.dev/characters/45"",""_id"":45},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Miles from Tomorrowland""],""videoGames"":[""Miles from Tomorrowland: Missions""],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Admirals Watson and Crick"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/c/c6/Admirals-Watson-and-Crick.png"",""Url"":""https://api.disneyapi.dev/characters/46"",""_id"":46},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Hercules (TV series)""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Adonis"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/c/ca/Adonis.jpg"",""Url"":""https://api.disneyapi.dev/characters/47"",""_id"":47},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Star Darlings""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Adora"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/6/6b/Profile-Adora.PNG"",""Url"":""https://api.disneyapi.dev/characters/48"",""_id"":48},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Goldie \u0026 Bear""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Adorable Norm"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/6/64/Adorable_Norm.png"",""Url"":""https://api.disneyapi.dev/characters/49"",""_id"":49},{""Films"":[""Hercules (film)""],""ShortFilms"":[],""TvShows"":[""Hercules (TV series)""],""videoGames"":[""Kingdom Hearts III""],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Achilles"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/d/d3/Vlcsnap-2015-05-06-23h04m15s601.png"",""Url"":""https://api.disneyapi.dev/characters/112"",""_id"":112},{""Films"":[""Zombies"",""Zombies 2"",""Zombies 3""],""ShortFilms"":[],""TvShows"":[""Addison\u0027s Moonstone Mystery (page does not exist)""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Addison"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/e/e5/Addison%25_27s_More_Than_Cheer_%25_3F_Teaser_ZOMBIES_2_Disney_Channel.jpg"",""Url"":""https://api.disneyapi.dev/characters/119"",""_id"":119},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Pair of Kings""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Aerosol"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/9/92/Screenshot_2016-09-08_at_10.18.27_PM.png"",""Url"":""https://api.disneyapi.dev/characters/130"",""_id"":130},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Jessie (TV series)""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Agatha"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/4/40/J119.png"",""Url"":""https://api.disneyapi.dev/characters/131"",""_id"":131},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Phineas and Ferb""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Agent E"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/d/d4/Agent_E_salutes_Perry.jpg"",""Url"":""https://api.disneyapi.dev/characters/132"",""_id"":132},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Lab Rats""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Agent Gordon"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/5/51/Screenshot_2016-09-12_at_8.13.42_PM.png"",""Url"":""https://api.disneyapi.dev/characters/133"",""_id"":133},{""Films"":[],""ShortFilms"":[],""TvShows"":[""The Replacements""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Agent K"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/8/88/The-replacements-kath-soucie-0.jpg"",""Url"":""https://api.disneyapi.dev/characters/134"",""_id"":134},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Quack Pack""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Agent X"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/e/ef/Agent_X.png"",""Url"":""https://api.disneyapi.dev/characters/135"",""_id"":135},{""Films"":[""Bolt (film)""],""ShortFilms"":[],""TvShows"":[],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Agent"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/b/b2/Agent-%28Bolt%29.jpg"",""Url"":""https://api.disneyapi.dev/characters/136"",""_id"":136},{""Films"":[],""ShortFilms"":[],""TvShows"":[""Miles from Tomorrowland""],""videoGames"":[],""ParkAttractions"":[],""Allies"":[],""Enemies"":[],""Name"":""Aggro"",""ImageUrl"":""https://static.wikia.nocookie.net/disney/images/9/9c/Aggro.png"",""Url"":""https://api.disneyapi.dev/characters/137"",""_id"":137}],""Count"":50,""TotalPages"":149,""NextPage"":""https://api.disneyapi.dev/characters?page=2""}";


    [Fact]
    public void Test_ConsoleTaskWorks()
    {
        HttpClientDecorator dec = new HttpClientDecorator(Setup());
        DisneyCharacterService service = new DisneyCharacterService(dec);
        ConsoleTask task = new(service);
        Func<Task<bool>> action = () =>  task.ExecuteAsync();
        var success = Task.Run(action).GetAwaiter().GetResult();
        Assert.True(success);
    }


    public IHttpClientFactory Setup()
    {
        var clientHandlerStub = new DelegatingHandlerStub();
        clientHandlerStub.ExpectedResult = data;
        clientHandlerStub.ContentType = "text/json";

        var client = new HttpClient(clientHandlerStub);        
        client.BaseAddress = new Uri("https://api.disneyapi.dev/");
        Mock<IHttpClientFactory> mockFactory = new();
        mockFactory.Setup(_ => _.CreateClient(It.IsAny<string>())).Returns(client);
        IHttpClientFactory factory = mockFactory.Object;

        return factory;
    }
}